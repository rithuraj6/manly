{% extends "adminpanel/base.html" %}
{% load admin_filters %}

{% block content %}

<style>
/* ============================================
   MANLY ADMIN - SALES REPORT PAGE
   ============================================ */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.sales-report-page {
    padding: 30px;
    min-height: 100vh;
    background: #0a0a0a;
    animation: fadeIn 0.6s ease;
    position: relative;
}

/* Animated Background Effect */
.sales-report-page::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 20% 50%, rgba(255, 140, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 140, 0, 0.02) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
    animation: backgroundPulse 15s ease-in-out infinite;
}

@keyframes backgroundPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    animation: slideInDown 0.6s ease;
    position: relative;
    z-index: 1;
}

.page-title {
    font-size: 36px;
    font-weight: 700;
    color: #fff;
    letter-spacing: 0.5px;
    text-shadow: 0 0 30px rgba(255, 140, 0, 0.3);
    position: relative;
    margin: 0;
}

.page-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, #ff8c00, transparent);
    border-radius: 2px;
}

/* Filter Bar */
.filter-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    padding: 20px;
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid #2a2a2a;
    border-radius: 16px;
    margin-bottom: 30px;
    animation: slideInDown 0.6s ease 0.1s backwards;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.filter-bar::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 140, 0, 0.02), transparent);
    animation: liquidFlow 8s ease-in-out infinite;
    pointer-events: none;
}

@keyframes liquidFlow {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    33% { transform: translate(10%, -10%) rotate(120deg); }
    66% { transform: translate(-10%, 10%) rotate(240deg); }
}

.filter-bar input[type="date"],
.filter-bar select {
    padding: 12px 16px;
    background: #0f0f0f;
    border: 1px solid #2a2a2a;
    border-radius: 10px;
    color: #e0e0e0;
    font-size: 14px;
    font-family: inherit;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
    min-width: 150px;
}

.filter-bar input[type="date"]:focus,
.filter-bar select:focus {
    outline: none;
    border-color: #ff8c00;
    background: #151515;
    box-shadow: 0 0 20px rgba(255, 140, 0, 0.2);
}

.filter-bar button[type="submit"],
.filter-bar a {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    position: relative;
    z-index: 1;
    white-space: nowrap;
}

.filter-bar button[type="submit"] {
    background: linear-gradient(135deg, #ff8c00, #ff6b00);
    color: #fff;
}

.filter-bar button[type="submit"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
}

.filter-bar a {
    background: #1a1a1a;
    color: #e0e0e0;
    border: 1px solid #2a2a2a;
}

.filter-bar a:hover {
    background: #2a2a2a;
    border-color: #ff8c00;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.2);
}

.btn-print,
.filter-bar a[href*="pdf"],
.filter-bar a[href*="excel"] {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: none;
}

.btn-print:hover,
.filter-bar a[href*="pdf"]:hover,
.filter-bar a[href*="excel"]:hover {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

/* KPI Grid */
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    animation: slideInUp 0.6s ease 0.2s backwards;
    position: relative;
    z-index: 1;
}

.kpi-card {
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid #2a2a2a;
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.kpi-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 140, 0, 0.05) 0%, transparent 70%);
    animation: liquidRotate 10s linear infinite;
    pointer-events: none;
}

@keyframes liquidRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.kpi-card:hover {
    transform: translateY(-5px);
    border-color: #ff8c00;
    box-shadow: 0 10px 30px rgba(255, 140, 0, 0.2);
}

.kpi-card.highlight {
    background: linear-gradient(135deg, rgba(255, 140, 0, 0.15), rgba(255, 107, 0, 0.08));
    border-color: rgba(255, 140, 0, 0.4);
}

.kpi-card.highlight:hover {
    box-shadow: 0 10px 40px rgba(255, 140, 0, 0.3);
}

.kpi-card p {
    font-size: 12px;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    margin-bottom: 12px;
    font-weight: 600;
    position: relative;
    z-index: 1;
}

.kpi-card h3 {
    font-size: 32px;
    font-weight: 700;
    color: #fff;
    margin: 0;
    position: relative;
    z-index: 1;
    line-height: 1.2;
}

.kpi-card.highlight h3 {
    color: #ff8c00;
    text-shadow: 0 0 20px rgba(255, 140, 0, 0.4);
}

/* Section Titles */
.section-title {
    font-size: 24px;
    font-weight: 700;
    color: #fff;
    margin: 50px 0 25px;
    position: relative;
    padding-left: 20px;
    animation: slideInLeft 0.6s ease;
    z-index: 1;
}

.section-title::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 6px;
    height: 30px;
    background: linear-gradient(180deg, #ff8c00, #ff6b00);
    border-radius: 3px;
}

/* Table Container */
.table-container {
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid #2a2a2a;
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 30px;
    animation: slideInUp 0.6s ease 0.3s backwards;
    position: relative;
    z-index: 1;
}

.table-container::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 140, 0, 0.02), transparent);
    animation: liquidFlow 8s ease-in-out infinite;
    pointer-events: none;
}

/* Report Table */
.report-table {
    width: 100%;
    border-collapse: collapse;
    position: relative;
    z-index: 1;
}

.report-table thead {
    background: #0f0f0f;
    position: relative;
    z-index: 1;
}

.report-table th {
    padding: 18px 20px;
    text-align: left;
    font-size: 12px;
    font-weight: 700;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    border-bottom: 2px solid #2a2a2a;
}

.report-table tbody tr {
    border-bottom: 1px solid #2a2a2a;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.report-table tbody tr:last-child {
    border-bottom: none;
}

.report-table tbody tr:hover {
    background: rgba(255, 140, 0, 0.05);
    transform: translateX(3px);
}

.report-table tbody tr[id^="details-"] {
    background: #0f0f0f !important;
}

.report-table tbody tr[id^="details-"]:hover {
    background: #151515 !important;
    transform: translateX(0) !important;
}

.report-table td {
    padding: 16px 20px;
    font-size: 14px;
    color: #e0e0e0;
    position: relative;
}

.report-table td strong {
    color: #ff8c00;
    font-weight: 700;
}

.report-table button {
    padding: 8px 16px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.report-table button:hover {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
}

/* Charts Container */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 30px;
    margin: 30px 0 50px;
    position: relative;
    z-index: 1;
}

.chart-wrapper {
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid #2a2a2a;
    border-radius: 16px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    animation: slideInUp 0.6s ease;
}

.chart-wrapper::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 140, 0, 0.03) 0%, transparent 70%);
    animation: liquidRotate 12s linear infinite;
    pointer-events: none;
}

.chart-wrapper h4 {
    font-size: 18px;
    font-weight: 600;
    color: #fff;
    margin: 0 0 20px 0;
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 10px;
}

canvas {
    position: relative;
    z-index: 1;
    max-height: 300px;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 40px 0;
    animation: fadeIn 0.8s ease 0.4s backwards;
    position: relative;
    z-index: 1;
}

.pagination a,
.pagination span {
    min-width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 16px;
    background: #1a1a1a;
    border: 1px solid #2a2a2a;
    border-radius: 10px;
    color: #e0e0e0;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    gap: 6px;
}

.pagination a:hover {
    background: #2a2a2a;
    border-color: #ff8c00;
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.2);
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Responsive Design */
@media (max-width: 1024px) {
    .kpi-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    
    .charts-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .sales-report-page {
        padding: 20px;
    }

    .page-title {
        font-size: 28px;
    }
    
    .filter-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-bar input,
    .filter-bar select,
    .filter-bar button,
    .filter-bar a {
        width: 100%;
    }
    
    .kpi-grid {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .kpi-card {
        padding: 18px;
    }

    .kpi-card h3 {
        font-size: 24px;
    }
    
    .table-container {
        overflow-x: auto;
    }

    .report-table {
        min-width: 800px;
    }

    .charts-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .page-title {
        font-size: 24px;
    }
    
    .kpi-grid {
        grid-template-columns: 1fr;
    }

    .kpi-card h3 {
        font-size: 28px;
    }
}
</style>

<div class="sales-report-page">
    <div class="page-header">
        <h2 class="page-title">Sales Report</h2>
    </div>

    <!-- FILTER SECTION -->
    <form method="get" class="filter-bar">
        <input type="date" name="from_date" value="{{ from_date }}" placeholder="From Date">
        <input type="date" name="to_date" value="{{ to_date }}" placeholder="To Date">

        <button type="submit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            Apply
        </button>
        
        <select name="filter" onchange="this.form.submit()">
            <option value="">Select Range</option>
            <option value="today" {% if active_filter == "today" %}selected{% endif %}>Today</option>
            <option value="last_7_days" {% if active_filter == "last_7_days" %}selected{% endif %}>Last 7 Days</option>
            <option value="this_month" {% if active_filter == "this_month" %}selected{% endif %}>This Month</option>
            <option value="this_year" {% if active_filter == "this_year" %}selected{% endif %}>This Year</option>
        </select>

        <a href="{% url 'admin_sales_report' %}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
            Reset
        </a>

        <a href="{% url 'admin_sales_report_print' %}?{{ request.GET.urlencode }}" target="_blank" class="btn-print">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 6 2 18 2 18 9"></polyline>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                <rect x="6" y="14" width="12" height="8"></rect>
            </svg>
            Print
        </a>
        
        <a href="{% url 'admin_sales_report_pdf' %}?{{ request.GET.urlencode }}" target="_blank">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Export PDF
        </a>
        
        <a href="{% url 'admin_sales_report_excel' %}?{{ request.GET.urlencode }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
            Export Excel
        </a>
    </form>

    <!-- KPI SECTION -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <p>Total Orders</p>
            <h3>{{ totals.total_orders }}</h3>
        </div>

        <div class="kpi-card">
            <p>Gross Amount</p>
            <h3>{{ totals.gross_amount|inr }}</h3>
        </div>

        <div class="kpi-card">
            <p>Coupon Discount</p>
            <h3>{{ totals.total_coupon_discount|inr }}</h3>
        </div>

        <div class="kpi-card">
            <p>Tax Collected</p>
            <h3>{{ totals.total_tax|inr }}</h3>
        </div>

        <div class="kpi-card">
            <p>Shipping</p>
            <h3>{{ totals.total_shipping|inr }}</h3>
        </div>

        <div class="kpi-card highlight">
            <p>Net Revenue</p>
            <h3>{{ totals.net_revenue|inr }}</h3>
        </div>
    </div>

    <!-- OFFER BREAKDOWN SECTION -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <p>Orders with Coupon</p>
            <h3>{{ offer_breakdown.orders_with_coupon }}</h3>
        </div>

        <div class="kpi-card">
            <p>Orders without Coupon</p>
            <h3>{{ offer_breakdown.orders_without_coupon }}</h3>
        </div>

        <div class="kpi-card">
            <p>Revenue (Coupon Orders)</p>
            <h3>{{ offer_breakdown.revenue_with_coupon|inr }}</h3>
        </div>

        <div class="kpi-card">
            <p>Revenue (No Coupon)</p>
            <h3>{{ offer_breakdown.revenue_without_coupon|inr }}</h3>
        </div>

       

        <div class="kpi-card">
            <p>Total Transactions</p>
            <h3>{{ totals.total_orders }}</h3>
        </div>

        <div class="kpi-card">
            <p>Total Items Sold</p>
            <h3>{{ totals.total_items_sold }}</h3>
        </div>
    </div>

    <!-- ORDERS TABLE -->
    <h3 class="section-title">Order Details</h3>
    <div class="table-container">
        <table class="report-table">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Items</th>
                    <th>Gross</th>
                    <th>Coupon</th>
                    <th>Tax</th>
                    <th>Shipping</th>
                    <th>Final</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
            {% for order in orders %}
                <tr>
                    <td>{{ order.order__order_id }}</td>
                    <td>{{ order.order__created_at|date:"d M Y" }}</td>
                    <td>{{ order.items_count }}</td>
                    <td>{{ order.gross_amount|inr }}</td>
                    <td>{{ order.order__coupon_discount|inr }}</td>
                    <td>{{ order.order__tax|inr }}</td>
                    <td>{{ order.order__shipping_charge|inr }}</td>
                    <td><strong>{{ order.net_revenue|inr }}</strong></td>
                    <td>
                        <button onclick="toggleDetails('{{ order.order__id }}')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                            View
                        </button>
                    </td>
                </tr>

                <!-- Collapsible Details -->
                <tr id="details-{{ order.order__id }}" style="display:none;">
                    <td colspan="9" style="padding: 20px;">
                        <strong style="color: #ff8c00; font-size: 16px;">Order Details</strong><br><br>
                        <strong>User:</strong> {{ order.order__user__email|default:"Deleted User" }}<br>
                        <strong>Order ID:</strong> {{ order.order__order_id }}<br>
                        <strong>Date:</strong> {{ order.order__created_at|date:"d M Y H:i" }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- PAGINATION -->
    {% if orders.has_other_pages %}
    <div class="pagination">
        {% if orders.has_previous %}
            <a href="?page={{ orders.previous_page_number }}&{{ request.GET.urlencode }}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Prev
            </a>
        {% endif %}

        <span>Page {{ orders.number }} of {{ orders.paginator.num_pages }}</span>

        {% if orders.has_next %}
            <a href="?page={{ orders.next_page_number }}&{{ request.GET.urlencode }}">
                Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </a>
        {% endif %}
    </div>
    {% endif %}

    <!-- TOP PRODUCTS & CATEGORIES -->
    <h3 class="section-title">Top 10 Selling Products</h3>
    <div class="table-container">
        <table class="report-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Units Sold</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
            {% for p in top_products %}
                <tr>
                    <td>{{ p.product__name }}</td>
                    <td>{{ p.units_sold }}</td>
                    <td><strong>{{ p.revenue|inr }}</strong></td>
                </tr>
            {% empty %}
                <tr><td colspan="3" style="text-align: center; padding: 40px; color: #666;">No data available</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <h3 class="section-title">Top 10 Selling Categories</h3>
    <div class="table-container">
        <table class="report-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Units Sold</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
            {% for c in top_categories %}
                <tr>
                    <td>{{ c.product__category__name }}</td>
                    <td>{{ c.units_sold }}</td>
                    <td><strong>{{ c.revenue|inr }}</strong></td>
                </tr>
            {% empty %}
                <tr><td colspan="3" style="text-align: center; padding: 40px; color: #666;">No data available</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- CHARTS SECTION -->
    <div class="charts-container">
        <div class="chart-wrapper">
            <h4>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="20" x2="12" y2="10"></line>
                    <line x1="18" y1="20" x2="18" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="16"></line>
                </svg>
                Top Products Performance
            </h4>
            <canvas id="productChart"></canvas>
        </div>

        <div class="chart-wrapper">
            <h4>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Category Performance
            </h4>
            <canvas id="categoryChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Modern Chart Configuration
Chart.defaults.color = '#e0e0e0';
Chart.defaults.borderColor = 'rgba(255, 140, 0, 0.1)';

const chartOptions = {
    responsive: true,
    maintainAspectRatio: true,
    plugins: {
        legend: {
            display: true,
            position: 'top',
            labels: {
                color: '#e0e0e0',
                font: {
                    size: 13,
                    weight: 600,
                    family: 'inherit'
                },
                padding: 15,
                usePointStyle: true
            }
        },
        tooltip: {
            backgroundColor: 'rgba(15, 15, 15, 0.95)',
            titleColor: '#ff8c00',
            bodyColor: '#e0e0e0',
            borderColor: '#2a2a2a',
            borderWidth: 1,
            padding: 12,
            cornerRadius: 8,
            displayColors: true,
            titleFont: {
                size: 14,
                weight: 'bold'
            },
            bodyFont: {
                size: 13
            }
        }
    },
    scales: {
        x: {
            grid: {
                color: 'rgba(255, 140, 0, 0.08)',
                drawBorder: false
            },
            ticks: {
                color: '#999',
                font: {
                    size: 11,
                    family: 'inherit'
                },
                maxRotation: 45,
                minRotation: 0
            }
        },
        y: {
            grid: {
                color: 'rgba(255, 140, 0, 0.08)',
                drawBorder: false
            },
            ticks: {
                color: '#999',
                font: {
                    size: 11,
                    family: 'inherit'
                }
            },
            beginAtZero: true
        }
    },
    animation: {
        duration: 1500,
        easing: 'easeInOutQuart'
    }
};

// Product Chart
const productCtx = document.getElementById('productChart');
if (productCtx) {
    new Chart(productCtx, {
        type: 'bar',
        data: {
            labels: [{% for p in top_products %}"{{ p.product__name }}",{% endfor %}],
            datasets: [{
                label: 'Units Sold',
                data: [{% for p in top_products %}{{ p.units_sold }},{% endfor %}],
                backgroundColor: 'rgba(255, 140, 0, 0.8)',
                hoverBackgroundColor: 'rgba(255, 140, 0, 1)',
                borderColor: 'rgba(255, 140, 0, 1)',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: chartOptions
    });
}

// Category Chart
const categoryCtx = document.getElementById('categoryChart');
if (categoryCtx) {
    new Chart(categoryCtx, {
        type: 'bar',
        data: {
            labels: [{% for c in top_categories %}"{{ c.product__category__name }}",{% endfor %}],
            datasets: [{
                label: 'Units Sold',
                data: [{% for c in top_categories %}{{ c.units_sold }},{% endfor %}],
                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                hoverBackgroundColor: 'rgba(59, 130, 246, 1)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: chartOptions
    });
}

// Toggle Details Function
function toggleDetails(orderId) {
    const row = document.getElementById("details-" + orderId);
    if (row) {
        const isVisible = row.style.display !== "none";
        row.style.display = isVisible ? "none" : "table-row";
        
        if (!isVisible) {
            row.style.animation = "slideInUp 0.3s ease";
        }
    }
}

// Add loading animation to buttons
document.querySelectorAll('.filter-bar button[type="submit"]').forEach(button => {
    button.addEventListener('click', function(e) {
        const svg = this.querySelector('svg');
        if (svg) {
            svg.style.animation = 'spin 1s linear infinite';
        }
        this.style.opacity = '0.7';
        this.style.pointerEvents = 'none';
    });
});

// Spin animation keyframes
const styleSheet = document.createElement('style');
styleSheet.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
document.head.appendChild(styleSheet);
</script>

{% endblock %}