{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="product-detail-wrapper">

    <!-- Product Section -->
    <section class="product-detail-container">

        <!-- Left: Product Images -->
        <div class="product-gallery">
            <!-- Thumbnail Column -->
            <div class="thumbnail-column">
                {% for image in product_images %}
                    <div class="thumbnail-item {% if forloop.first %}active{% endif %}" 
                         data-image="{{ image.image.url }}">
                        <img src="{{ image.image.url }}" alt="{{ product.name }}">
                    </div>
                {% endfor %}
            </div>

            <!-- Main Image with Zoom -->
             
            <div class="main-image-container">
                <button class="image-nav nav-left" aria-label="Previous image">&#10094;</button>
    
                
                <div class="main-image" id="mainImageWrapper">
                    
                    {% if product_images %}
                        <img id="mainImage"
                             src="{{ product_images.first.image.url }}"
                             alt="{{ product.name }}">
                    {% endif %}
                    <div class="zoom-lens" id="zoomLens"></div>
                </div>
                <button class="image-nav nav-right" aria-label="Next image">&#10095;</button>
                
              
            </div>
        </div>

        <!-- Right: Product Info -->
        <div class="product-info">

            <h1 class="product-title">{{ product.name }}</h1>

            <!-- Rating + Stock -->
            <div class="rating-stock-wrapper">
                <div class="product-rating">
                    <div class="stars">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <span class="rating-value">{{ average_rating }}</span>
                    </div>
                    <span class="rating-reviews">{{ total_reviews }} reviews</span>
                </div>

                <div id="stockBadge"
                     class="stock-badge {% if in_stock %}in-stock{% else %}out-stock{% endif %}">
                    {% if in_stock %}In Stock{% else %}Out of Stock{% endif %}
                </div>
            </div>

            <!-- Price -->
            <div class="price-section">
                {% if offer_percentage %}
                    <span class="current-price">â‚¹{{ discounted_price }}</span>
                    <span class="old-price">
                        <strike>â‚¹{{ product.base_price }}</strike>
                    </span>
                    <span class="offer-pill">{{ offer_percentage }}% OFF</span>
                {% else %}
                    <span class="current-price">â‚¹{{ product.base_price }}</span>
                {% endif %}
            </div>

            <div class="divider"></div>

            <!-- Size Select -->
            <div class="size-selector-wrapper">
                <label class="input-label">Select Size</label>

                <select id="sizeSelect"
                        class="size-select"
                        {% if not in_stock %}disabled{% endif %}>
                    <option value="" selected disabled>Select size</option>

                    {% for v in variants %}
                        <option value="{{ v.id }}"
                                {% if v.stock == 0 %}disabled{% endif %}>
                            {{ v.size }}
                            {% if v.stock == 0 %}(Out of stock){% endif %}
                        </option>
                    {% endfor %}
                </select>

                <p id="stockMessage" class="stock-message"></p>
            </div>

            <div class="divider"></div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn wishlist-btn"
                        data-product-id="{{ product.uuid }}">
                    <svg width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span class="wishlist-text">Wishlist</span>
                </button>


                <button class="btn buy-now-btn" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    Buy Now
                </button>

                <button class="btn add-to-cart-btn"
                        data-product-id="{{ product.uuid}}"
                        disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span class="btn-text">Add to Cart</span>
                </button>
            </div>

            <div class="divider"></div>

            <!-- Description -->
            <div class="product-details">
                <h3 class="details-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Product Description
                </h3>
                <p class="product-description">
                    {{ product.description|linebreaks }}
                </p>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section">
        <div class="reviews-header">
            <h2 class="section-title">Customer Reviews</h2>
            <div class="review-summary-badge">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                {{ average_rating }} / 5 ({{ total_reviews }})
            </div>
        </div>

        <div class="reviews-container">
            {% if reviews %}
                {% for r in reviews %}
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                             <strong class="reviewer-name">
                                     {{ r.user.first_name }}
                             </strong>
                                <span style="font-size:12px;color:#999;">
                                {{ r.user.profile.first_name}}


                                </span>
                            </div>
                            <div class="review-rating">
                                {% for i in "12345" %}
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if forloop.counter <= r.rating %}#fbbf24{% else %}#e5e5e5{% endif %}">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                {% endfor %}
                                <span class="rating-number">{{ r.rating }}/5</span>
                            </div>
                        </div>
                        <p class="review-text">{{ r.review_text }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <div class="review-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    <p>No reviews yet</p>
                </div>
            {% endif %}
        </div>
    </section>

    <!-- Similar Products -->
    <section class="similar-products">
        <div class="section-header">
            <h2 class="section-title">Similar Collection</h2>
            <div class="slider-controls">
                <button class="slider-btn btn-prev" id="sliderPrev" aria-label="Previous products">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <button class="slider-btn btn-next" id="sliderNext" aria-label="Next products">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <div class="product-slider-container">
            <div class="product-slider" id="productSlider">
                {% for item in similar_products %}
                    <a href="{% url 'product_detail' item.uuid %}" class="similar-card">
                        <div class="similar-image-wrapper">
                            {% with img=item.images.first %}
                                {% if img %}
                                    <img src="{{ img.image.url }}" alt="{{ item.name }}">
                                {% else %}
                                    <img src="{% static 'images/placeholder.png' %}">
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="similar-info">
                            <h4 class="similar-name">{{ item.name }}</h4>
                           <p class="similar-price">
                                {% if item.offer_percentage %}
                                    <strike>â‚¹{{ item.base_price }}</strike>
                                    â‚¹{{ item.discounted_price }}
                                {% else %}
                                    â‚¹{{ item.base_price }}
                                {% endif %}
                            </p>

                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>
    </section>

</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// âœ… CHECK IF USER IS AUTHENTICATED
const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

// Variant Stock Map
const variantStockMap = {
    {% for v in variants %}
        "{{ v.id }}": {{ v.stock }},
    {% endfor %}
};

const sizeSelect = document.getElementById("sizeSelect");
const stockMsg = document.getElementById("stockMessage");
const cartBtn = document.querySelector(".add-to-cart-btn");
const buyBtn = document.querySelector(".buy-now-btn");
const stockBadge = document.getElementById("stockBadge");

// Update Stock UI
function updateStockUI() {
    const variantId = sizeSelect.value;
    if (!variantId) return;

    const stock = variantStockMap[variantId];

    if (stock === 0) {
        stockMsg.innerText = "Out of stock";
        stockMsg.className = "stock-message stock-low";
        cartBtn.disabled = true;
        buyBtn.disabled = true;
        stockBadge.innerText = "Out of Stock";
        stockBadge.className = "stock-badge out-stock";
    } else if (stock <= 9) {
        stockMsg.innerText = `Only ${stock} left`;
        stockMsg.className = "stock-message stock-low";
        cartBtn.disabled = false;
        buyBtn.disabled = false;
        stockBadge.innerText = "Low Stock";
        stockBadge.className = "stock-badge out-stock";
    } else {
        stockMsg.innerText = "In stock";
        stockMsg.className = "stock-message stock-normal";
        cartBtn.disabled = false;
        buyBtn.disabled = false;
        stockBadge.innerText = "In Stock";
        stockBadge.className = "stock-badge in-stock";
    }
}

sizeSelect?.addEventListener("change", updateStockUI);

// âœ… Add to Cart - WITH AUTH CHECK
cartBtn?.addEventListener("click", function () {
    const variantId = sizeSelect.value;
    if (!variantId) {
        alert("Please select a size");
        return;
    }

    // âœ… REDIRECT TO LOGIN IF NOT AUTHENTICATED
    if (!isAuthenticated) {
        window.location.href = "{% url 'login' %}?next={{ request.path }}";
        return;
    }

    cartBtn.classList.add("loading");
    cartBtn.querySelector(".btn-text").innerText = "Adding...";

    fetch("/cart/add/", {
        method: "POST",
        headers: {
            "X-CSRFToken": getCookie("csrftoken"),
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
            product_id: "{{ product.uuid }}",
            variant_id: variantId,
            quantity: 1,
        }),
    })
    .then(res => res.json())
    .then(data => {
        cartBtn.classList.remove("loading");
        if (data.success) {
            cartBtn.querySelector(".btn-text").innerText = "Added âœ“";
            
            // âœ… UPDATE NAVBAR CART COUNT
            if (typeof window.updateNavbarCartCount === 'function') {
                window.updateNavbarCartCount(data.cart_count);
            }
            
            setTimeout(() => {
                cartBtn.querySelector(".btn-text").innerText = "Add to Cart";
            }, 2000);
        } else {
            cartBtn.querySelector(".btn-text").innerText = "Add to Cart";
            alert(data.message || "Unable to add to cart");
        }
    })
    .catch(() => {
        cartBtn.classList.remove("loading");
        cartBtn.querySelector(".btn-text").innerText = "Add to Cart";
        alert("Something went wrong");
    });
});

// âœ… Buy Now - WITH AUTH CHECK
buyBtn?.addEventListener("click", function () {
    const variantId = sizeSelect.value;
    if (!variantId) {
        alert("Please select a size");
        return;
    }

    // âœ… REDIRECT TO LOGIN IF NOT AUTHENTICATED
    if (!isAuthenticated) {
        window.location.href = "{% url 'login' %}?next={{ request.path }}";
        return;
    }

    fetch("/cart/add/", {
        method: "POST",
        headers: {
            "X-CSRFToken": getCookie("csrftoken"),
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
            product_id: "{{ product.uuid}}",
            variant_id: variantId,
            quantity: 1,
        }),
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // âœ… UPDATE NAVBAR CART COUNT BEFORE REDIRECT
            if (typeof window.updateNavbarCartCount === 'function') {
                window.updateNavbarCartCount(data.cart_count);
            }
            
            window.location.href = "/orders/checkout/";
        } else {
            alert(data.message || "Unable to proceed to checkout");
        }
    })
    .catch(() => {
        alert("Something went wrong");
    });
});

// ============== IMAGE GALLERY ==============

// Thumbnail Click
document.querySelectorAll('.thumbnail-item').forEach(thumb => {
    thumb.addEventListener('click', function() {
        const imageUrl = this.getAttribute('data-image');
        const mainImage = document.getElementById('mainImage');
        
        // Update main image
        mainImage.src = imageUrl;
        
        // Update active thumbnail
        document.querySelectorAll('.thumbnail-item').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
    });
});

// ============== NAVIGATION BUTTONS FOR IMAGE GALLERY ==============

const navLeft = document.querySelector('.nav-left');
const navRight = document.querySelector('.nav-right');
const thumbnails = document.querySelectorAll('.thumbnail-item');

let currentIndex = 0;

navLeft?.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + thumbnails.length) % thumbnails.length;
    thumbnails[currentIndex].click();
});

navRight?.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % thumbnails.length;
    thumbnails[currentIndex].click();
});

// Update currentIndex when thumbnail is clicked manually
thumbnails.forEach((thumb, index) => {
    thumb.addEventListener('click', () => {
        currentIndex = index;
    });
});

// ============== IMAGE ZOOM ON HOVER ==============

const imageWrapper = document.getElementById('mainImageWrapper');
const mainImage = document.getElementById('mainImage');
const zoomLens = document.getElementById('zoomLens');

let isZooming = false;

imageWrapper.addEventListener('mouseenter', function() {
    isZooming = true;
    zoomLens.style.opacity = '1';
});

imageWrapper.addEventListener('mouseleave', function () {
    isZooming = false;
    zoomLens.style.opacity = '0';
    mainImage.style.transform = "scale(1)";
});

imageWrapper.addEventListener('mousemove', function (e) {
    if (!isZooming) return;

    const rect = imageWrapper.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const xPercent = (x / rect.width) * 100;
    const yPercent = (y / rect.height) * 100;

    // Lens position
    zoomLens.style.left = (x - 75) + 'px';
    zoomLens.style.top = (y - 75) + 'px';

    // REAL zoom effect
    mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    mainImage.style.transform = "scale(2)";
});

// ============== SIMILAR PRODUCTS SLIDER ==============

const slider = document.getElementById('productSlider');
const prevBtn = document.getElementById('sliderPrev');
const nextBtn = document.getElementById('sliderNext');

let scrollAmount = 0;
const scrollStep = 320; // card width + gap

prevBtn?.addEventListener('click', () => {
    scrollAmount = Math.max(0, scrollAmount - scrollStep);
    slider.style.transform = `translateX(-${scrollAmount}px)`;
});

nextBtn?.addEventListener('click', () => {
    const maxScroll = slider.scrollWidth - slider.parentElement.offsetWidth;
    scrollAmount = Math.min(maxScroll, scrollAmount + scrollStep);
    slider.style.transform = `translateX(-${scrollAmount}px)`;
});


document.addEventListener("DOMContentLoaded", function () {

    const wishlistBtn = document.querySelector(".wishlist-btn");
    if (!wishlistBtn) return;

    const productId = wishlistBtn.dataset.productId;
    const textEl = wishlistBtn.querySelector(".wishlist-text");

    // ðŸš« If user not logged in â†’ redirect on click
    wishlistBtn.addEventListener("click", function () {
        if (!isAuthenticated) {
            window.location.href =
                "{% url 'login' %}?next={{ request.path }}";
            return;
        }

        toggleWishlist();
    });

    // ðŸ” Initial state check
    fetch(`/wishlist/check/?product_id=${productId}`)
        .then(res => res.json())
        .then(data => {
            updateWishlistUI(data.in_wishlist);
        });

    function toggleWishlist() {
        fetch("/wishlist/toggle/", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCookie("csrftoken"),
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({
                product_id: productId
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                updateWishlistUI(data.action === "added");

                // ðŸ§® Update navbar wishlist count later
                if (typeof window.updateNavbarWishlistCount === "function") {
                    window.updateNavbarWishlistCount(data.wishlist_count);
                }
            }
        });
    }

    function updateWishlistUI(inWishlist) {
        if (inWishlist) {
            wishlistBtn.classList.add("active");
            textEl.innerText = "Remove from Wishlist";
        } else {
            wishlistBtn.classList.remove("active");
            textEl.innerText = "Add to Wishlist";
        }
    }

});
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

/* ==========================================
   BASE RESET & VARIABLES
   ========================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.product-detail-wrapper {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: clamp(30px, 6vw, 60px) clamp(16px, 4vw, 40px);
    font-family: 'Inter', sans-serif;
    background: #fafafa;
}

/* ==========================================
   PRODUCT DETAIL CONTAINER
   ========================================== */
.product-detail-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: clamp(30px, 6vw, 60px);
    margin-bottom: clamp(40px, 8vw, 80px);
}

/* ==========================================
   PRODUCT GALLERY
   ========================================== */
.product-gallery {
    display: flex;
    gap: clamp(12px, 2vw, 20px);
}

.thumbnail-column {
    display: flex;
    flex-direction: column;
    gap: clamp(10px, 1.5vw, 12px);
}

.thumbnail-item {
    width: clamp(70px, 10vw, 80px);
    height: clamp(90px, 12vw, 100px);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
    opacity: 0.6;
}

.thumbnail-item:hover {
    opacity: 1;
    transform: scale(1.05);
}

.thumbnail-item.active {
    border-color: #1a1a1a;
    opacity: 1;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.thumbnail-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.main-image-container {
    flex: 1;
    position: relative;
}

.main-image {
    position: relative;
    border-radius: clamp(12px, 2vw, 20px);
    overflow: hidden;
    background: #fff;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    aspect-ratio: 3/4;
    cursor: crosshair;
}

.main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

/* Image Navigation Buttons */
.image-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: clamp(40px, 6vw, 48px);
    height: clamp(40px, 6vw, 48px);
    border-radius: 50%;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none;
    cursor: pointer;
    z-index: 20;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(16px, 2.5vw, 20px);
    transition: all 0.3s ease;
}

.image-nav:hover {
    background: rgba(0,0,0,0.85);
    transform: translateY(-50%) scale(1.1);
}

.image-nav:active {
    transform: translateY(-50%) scale(0.95);
}

.nav-left {
    left: clamp(8px, 1.5vw, 12px);
}

.nav-right {
    right: clamp(8px, 1.5vw, 12px);
}

/* Zoom Lens (Desktop Only) */
.zoom-lens {
    position: absolute;
    width: 150px;
    height: 150px;
    border: 3px solid rgba(255,255,255,0.8);
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(2px);
    border-radius: 50%;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 10;
}

/* ==========================================
   PRODUCT INFO
   ========================================== */
.product-info {
    display: flex;
    flex-direction: column;
    gap: clamp(18px, 3vw, 24px);
}

.product-title {
    font-size: clamp(24px, 4vw, 32px);
    font-weight: 700;
    color: #1a1a1a;
    letter-spacing: -0.5px;
    line-height: 1.2;
}

.rating-stock-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: clamp(12px, 2vw, 16px);
}

.product-rating {
    display: flex;
    align-items: center;
    gap: clamp(12px, 2vw, 16px);
    flex-wrap: wrap;
}

.stars {
    display: flex;
    align-items: center;
    gap: 6px;
}

.rating-value {
    font-size: clamp(15px, 2.2vw, 16px);
    font-weight: 700;
    color: #1a1a1a;
}

.rating-reviews {
    font-size: clamp(13px, 2vw, 14px);
    color: #666;
}

.stock-badge {
    display: inline-flex;
    align-items: center;
    padding: clamp(6px, 1.2vw, 8px) clamp(12px, 2vw, 16px);
    border-radius: 20px;
    font-size: clamp(11px, 1.6vw, 12px);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stock-badge.in-stock {
    background: #e8f5e9;
    color: #2e7d32;
}

.stock-badge.out-stock {
    background: #ffebee;
    color: #c62828;
}

.price-section {
    display: flex;
    align-items: baseline;
    gap: clamp(10px, 2vw, 12px);
    flex-wrap: wrap;
}

.current-price {
    font-size: clamp(28px, 5vw, 36px);
    font-weight: 700;
    color: #1a1a1a;
}

.old-price {
    font-size: clamp(16px, 2.5vw, 18px);
    color: #a70000;
}

.offer-pill {
    background: #f82323;
    color: #fff;
    font-size: clamp(11px, 1.6vw, 12px);
    font-weight: 700;
    padding: clamp(4px, 0.8vw, 6px) clamp(8px, 1.5vw, 10px);
    border-radius: 20px;
}

.divider {
    width: 100%;
    height: 1px;
    background: #e5e5e5;
}

/* ==========================================
   SIZE SELECTOR
   ========================================== */
.size-selector-wrapper {
    display: flex;
    flex-direction: column;
    gap: clamp(8px, 1.5vw, 10px);
}

.input-label {
    font-size: clamp(13px, 2vw, 14px);
    font-weight: 600;
    color: #1a1a1a;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.size-select {
    width: 100%;
    max-width: 200px;
    padding: clamp(12px, 2vw, 14px) clamp(14px, 2.5vw, 16px);
    border: 2px solid #e5e5e5;
    border-radius: 10px;
    font-size: clamp(14px, 2.2vw, 15px);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #fff;
    min-height: 48px;
}

.size-select:hover:not(:disabled) {
    border-color: #1a1a1a;
}

.size-select:focus {
    outline: none;
    border-color: #1a1a1a;
    box-shadow: 0 0 0 3px rgba(26,26,26,0.1);
}

.stock-message {
    font-size: clamp(12px, 1.8vw, 13px);
    font-weight: 600;
    margin-top: 6px;
}

.stock-normal {
    color: #2e7d32;
}

.stock-low {
    color: #c62828;
}

/* ==========================================
   ACTION BUTTONS
   ========================================== */
.action-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(10px, 2vw, 12px);
}

.btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: clamp(14px, 2.5vw, 16px) clamp(16px, 3vw, 20px);
    border-radius: 12px;
    border: none;
    font-size: clamp(13px, 2vw, 14px);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 52px;
}

.btn svg {
    flex-shrink: 0;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.btn:active:not(:disabled) {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.wishlist-btn {
    background: #fff;
    color: #ef4444;
    border: 2px solid #ef4444;
}

.wishlist-btn:hover:not(:disabled) {
    background: #ef4444;
    color: #fff;
}

.wishlist-btn.active {
    background: #ef4444;
    color: #fff;
}

.buy-now-btn {
    background: #22c55e;
    color: #fff;
}

.buy-now-btn:hover:not(:disabled) {
    background: #16a34a;
}

.add-to-cart-btn {
    background: #1a1a1a;
    color: #fff;
}

.add-to-cart-btn:hover:not(:disabled) {
    background: #000;
}

/* ==========================================
   PRODUCT DETAILS
   ========================================== */
.product-details {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.details-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: clamp(15px, 2.2vw, 16px);
    font-weight: 700;
    color: #1a1a1a;
}

.product-description {
    font-size: clamp(14px, 2vw, 15px);
    line-height: 1.7;
    color: #666;
}

/* ==========================================
   REVIEWS SECTION
   ========================================== */
.reviews-section {
    background: #fff;
    border-radius: clamp(16px, 2.5vw, 20px);
    padding: clamp(24px, 5vw, 40px);
    margin-bottom: clamp(40px, 6vw, 60px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
}

.reviews-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: clamp(20px, 4vw, 30px);
    flex-wrap: wrap;
    gap: clamp(12px, 2vw, 16px);
}

.section-title {
    font-size: clamp(20px, 3.5vw, 24px);
    font-weight: 700;
    color: #1a1a1a;
}

.review-summary-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: clamp(8px, 1.5vw, 10px) clamp(16px, 3vw, 20px);
    background: #fef3c7;
    border-radius: 20px;
    font-weight: 600;
    font-size: clamp(13px, 2vw, 14px);
    color: #1a1a1a;
}

.reviews-container {
    display: flex;
    flex-direction: column;
    gap: clamp(16px, 2.5vw, 20px);
}

.review-card {
    padding: clamp(18px, 3vw, 24px);
    background: #f8f8f8;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 12px;
}

.reviewer-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.reviewer-name {
    font-size: clamp(14px, 2.2vw, 15px);
    color: #1a1a1a;
}

.review-rating {
    display: flex;
    align-items: center;
    gap: 6px;
}

.rating-number {
    font-size: clamp(13px, 2vw, 14px);
    font-weight: 600;
    color: #666;
    margin-left: 4px;
}

.review-text {
    font-size: clamp(13px, 2vw, 14px);
    line-height: 1.6;
    color: #666;
}

.review-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: clamp(40px, 8vw, 60px) 20px;
    color: #999;
    gap: 16px;
}

.review-placeholder p {
    font-size: clamp(14px, 2.2vw, 15px);
}

/* ==========================================
   SIMILAR PRODUCTS
   ========================================== */
.similar-products {
    margin-bottom: clamp(30px, 5vw, 40px);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: clamp(20px, 4vw, 30px);
    flex-wrap: wrap;
    gap: clamp(12px, 2vw, 16px);
}

.slider-controls {
    display: flex;
    gap: 12px;
}

.slider-btn {
    width: clamp(44px, 7vw, 48px);
    height: clamp(44px, 7vw, 48px);
    border-radius: 50%;
    border: 2px solid #e5e5e5;
    background: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.slider-btn:hover {
    background: #1a1a1a;
    border-color: #1a1a1a;
    transform: scale(1.1);
}

.slider-btn:active {
    transform: scale(0.95);
}

.slider-btn:hover svg {
    stroke: #fff;
}

.product-slider-container {
    overflow: hidden;
    padding: 10px 0;
}

.product-slider {
    display: flex;
    gap: clamp(16px, 3vw, 24px);
    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.similar-card {
    min-width: clamp(220px, 35vw, 280px);
    background: #fff;
    border-radius: 16px;
    padding: clamp(12px, 2vw, 16px);
    text-decoration: none;
    color: #1a1a1a;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    transition: all 0.3s ease;
}

.similar-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.12);
}

.similar-image-wrapper {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 12px;
    aspect-ratio: 3/4;
}

.similar-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
}

.similar-card:hover .similar-image-wrapper img {
    transform: scale(1.1);
}

.similar-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.similar-name {
    font-size: clamp(13px, 2vw, 15px);
    font-weight: 600;
    color: #1a1a1a;
    line-height: 1.3;
}

.similar-price {
    font-size: clamp(16px, 2.5vw, 18px);
    font-weight: 700;
    color: #1a1a1a;
}

/* ==========================================
   RESPONSIVE BREAKPOINTS
   ========================================== */

/* Large Tablets (1024px and below) */
@media (max-width: 1024px) {
    .product-detail-container {
        grid-template-columns: 1fr;
        gap: 40px;
    }

    .zoom-lens {
        display: none !important;
    }
}

/* Tablets (768px and below) */
@media (max-width: 768px) {
    .product-gallery {
        flex-direction: column-reverse;
    }

    .thumbnail-column {
        flex-direction: row;
        overflow-x: auto;
        gap: 10px;
        padding-bottom: 8px;
        -webkit-overflow-scrolling: touch;
    }

    .thumbnail-item {
        min-width: 70px;
        height: 90px;
    }

    .action-buttons {
        grid-template-columns: 1fr;
        gap: 12px;
    }

    .btn {
        width: 100%;
        min-height: 54px;
        font-size: 15px;
    }

    .size-select {
        max-width: 100%;
        width: 100%;
    }
}

/* Mobile Phones (480px and below) */
@media (max-width: 480px) {
    .product-detail-wrapper {
        padding: 24px 12px;
    }

    .product-title {
        font-size: 22px;
        line-height: 1.3;
    }

    .current-price {
        font-size: 26px;
    }

    .btn {
        padding: 16px 20px;
        font-size: 14px;
        min-height: 56px;
    }

    .image-nav {
        width: 36px;
        height: 36px;
        font-size: 14px;
    }

    .nav-left {
        left: 6px;
    }

    .nav-right {
        right: 6px;
    }

    .product-description {
        font-size: 15px;
        line-height: 1.8;
    }

    .review-card {
        padding: 16px;
    }

    .similar-card {
        min-width: 200px;
    }
}

/* Very Small Mobile (360px and below) */
@media (max-width: 360px) {
    .product-title {
        font-size: 20px;
    }

    .current-price {
        font-size: 24px;
    }

    .btn {
        font-size: 13px;
        padding: 14px 16px;
        min-height: 52px;
    }

    .thumbnail-item {
        min-width: 60px;
        height: 80px;
    }
}

/* Landscape Orientation */
@media (max-height: 600px) and (orientation: landscape) {
    .product-detail-wrapper {
        padding: 20px 16px;
    }

    .btn {
        min-height: 44px;
        padding: 12px 16px;
    }
}

/* Print Styles */
@media print {
    .image-nav,
    .slider-controls,
    .action-buttons,
    .zoom-lens {
        display: none !important;
    }

    .product-detail-wrapper {
        padding: 20px;
    }
}
</style>

{% endblock %}